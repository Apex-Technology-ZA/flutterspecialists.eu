---
import BaseLayout from "@layouts/BaseLayout.astro";
import { getCollection, getEntry } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("courses");
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { slug: entry.slug },
  }));
}

const { slug } = Astro.props as { slug: string };
const course = await getEntry("courses", slug);
if (!course) {
  throw new Error(`Course not found for slug: ${slug}`);
}
const data = course.data;
---

<BaseLayout title={`${data.title} â€” Course`} description={data.description}>
  <section class="container py-16">
    <a href="/courses/" class="text-sm text-primary hover:underline">&larr; All courses</a>

    <h1 class="mt-2 text-3xl font-bold">{data.title}</h1>
    <p class="mt-3 text-gray-700 max-w-3xl">{data.description}</p>

    <div class="mt-4 flex flex-wrap items-center gap-3 text-sm text-gray-600">
      {typeof data.price === "number" && <span class="rounded bg-blue-50 px-2 py-1 text-primary">USD {data.price.toFixed(2)}</span>}
      {data.duration && <span class="rounded bg-gray-100 px-2 py-1">{data.duration}</span>}
      {data.level && <span class="rounded bg-gray-100 px-2 py-1 capitalize">{data.level}</span>}
    </div>

    {data.heroImage && (
      <img src={data.heroImage} alt="" class="mt-6 rounded border" loading="lazy" />
    )}

    {data.outline?.length ? (
      <div class="mt-8">
        <h2 class="text-xl font-semibold">What you'll learn</h2>
        <ul class="mt-3 list-disc pl-6 space-y-1 text-gray-700">
          {data.outline.map((item) => <li>{item}</li>)}
        </ul>
      </div>
    ) : null}

    <div class="mt-8 flex flex-wrap gap-3">
      {data.paymentLink ? (
        <a
          href={data.paymentLink}
          class="inline-flex items-center rounded bg-primary px-5 py-3 text-white hover:bg-secondary"
          rel="noopener"
        >
          Buy now
        </a>
      ) : (
        <a
          href="/contact"
          class="inline-flex items-center rounded bg-primary px-5 py-3 text-white hover:bg-secondary"
        >
          Enquire to purchase
        </a>
      )}
      <a
        href="/contact"
        class="inline-flex items-center rounded border border-gray-300 px-5 py-3 text-gray-700 hover:bg-gray-50"
      >
        Questions? Contact us
      </a>
    </div>
  </section>
</BaseLayout>